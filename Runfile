require 'snapcrawl'
title   "Snapcrawl Docker Toolbelt"

command :docker

help   "Build the docker images"
action :build, :b do
  system "docker build -t dannyben/snapcrawl ."
  system "docker tag dannyben/snapcrawl dannyben/snapcrawl:#{Snapcrawl::VERSION}"
  system "docker images |grep snapcrawl"
end

help   "Smoke test the docker image"
action :test, :t do
  snapcrawl_version = `docker run --rm dannyben/snapcrawl --version`.chomp
  if snapcrawl_version != Snapcrawl::VERSION
    puts "FAIL: docker snapcrawl version is #{snapcrawl_version}, expected #{Snapcrawl::VERSION}"
    exit 1
  else
    puts "PASS: docker snapcrawl version is #{snapcrawl_version}"
  end
end

help   "Push the docker images to Docker Hub"
action :push, :p do
  system "docker push dannyben/snapcrawl"
  system "docker push dannyben/snapcrawl:#{Snapcrawl::VERSION}"
end

endcommand

